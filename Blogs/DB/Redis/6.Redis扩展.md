Redis扩展
--------

### 一、Redis扩展场景
总结为：单台Redis服务的局限性
* 存储数据容量的限制
* 高并发下读写问题处理延迟

### 二、Redis扩展内容
* 扩展读性能
* 扩展写性能及相应的内存容量的扩展
* 扩展复杂的查询语句

### 三、目前所知的提高性能的几种途径
* 短结构/分片等等
* 选择更好性能的结构存储：不要把列表当集合使用；也不要获取整个散列在客户端排序，而是从一开始就选择有序集合存储等等
* 大体积对象考虑进行压缩读写
* 利用流水线批量进行操作(至于流水线是否需要开启事务由具体情形而定)
https://www.cnblogs.com/ivictor/archive/2016/04/29/5446503.html
* 连接池


### 四、扩展读性能
在Redis能够存储所有数据并能正常地处理写查询的情况下，让Redis的读查询处理能力超过单台Redis服务器所能提供的读查询处理能力

#### 1. 提升只读从服务器读查询性能

提升Redis读取能力的最简单的方法就是添加只读从服务器
你没看错，就是添加只读从服务器！！！

**记住：只对主服务器进行写入：**
* 使用只读从服务器时，务必记得只对Redis主服务器进行写入
* 默认情况下，对配置为从Redis服务器进行写入会引发错误(纵然这个从服务器是其他从服务器的主服务器)
* 默认上面的这个功能是关闭的，但也可以设置为开启

**从服务器开启和结束：**
* 将要设置为从服务器的Redis配置文件里加上slaveof host port
* host/port代表主服务的IP地址和端口号
* 也可以对一个正在运行的Redis服务器发送SLAVEOF host port命令将其配置为从服务器
* 从服务器连接至主服务器，从服务器原本存储的数据将被清空！
* 向从服务器发送SLAVEOF no one命令，可以让从服务器与主服务器断开连接
* ==具体参照此系列的第四篇文章：Redis复制==
 
#### 2. 多个Redis从服务器查询面临的问题

##### 重同步

* 每当有从连主，主就会为从创建快照
* 在创建快照结束之前，又有多个从连主，在一定的时间间隔内，那么这些多个从将会收到同一个快照
* 效率很好，因为创建一个快照就行，不用重复创建
* 但是需要向多个从发送快照的多个副本，耗尽主服务器的大部分宽带，延迟变高，更有甚者会导致主已经建立连接的从断开
* 解决上述问题(从服务器重同步resync)问题的其中一种方法：减少主服务器需要传送给从服务器的数据数量，也就是构建从服务器树。相当一部分的重同步应该交由中间从服务器去做，而不用都去劳烦主服务器去做同步
* 另一个解决重同步问题的方法是对网络连接进行压缩，从而减少需要传送的数据量：使用带压缩的SSH隧道进行连接可以明显的降低宽带占用，采用此方法，还记得需要设置，在SSH连接断线后自动重连
* 另一个是OpenVPN（使用AED加密和lzo压缩）

##### 主服务器临时下线或者永久下线
Redis Sentinel(Redis哨兵)
* 独立进程
* 可以单个进程监控整个Redis主从或者集群
* 提高哨兵高可用性：哨兵也可以做成分布式集群，提高高可用
* 依附于Redis服务器，Redis Sentinel可看作运行在特殊模式下的Redis服务器













