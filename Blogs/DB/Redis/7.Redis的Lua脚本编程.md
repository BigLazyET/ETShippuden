Redis的Lua脚本编程
--------------

**Redis从2.6版本开始引入使用Lua编程语言进行的服务器端脚本编程功能**
* 此功能可以让用户直接在Redis服务器内部执行各种操作
* 简化代码并提高性能

### 一、将Lua脚本载入Redis

#### 1. 以Python Redis客户端为例
旧的Python Redis客户端并未为Redis 2.6提供直接载入或者执行Lua脚本的功能

**创建一个脚本载入程序：**
* 使用SCRIPT LOAD命令，接受字符串格式的Lua脚本为参数
* 此命令会把脚本存储起来等待之后使用，然后返回被存储脚本的SHA1检验和
* 之后用户调用EVALSHA命令，传入脚本的SHA1校验和以及脚本所需的全部参数就可以调用之前存储的脚本了

**重点认知：**
* EVAL和EVALSHA命令执行脚本之后，会自动把脚本缓存起来
* EVAL和EVALSHA命令执行脚本之后，缓存产生的SHA1校验和是完全相同的
* 函数缓存了SHA1校验和，但是服务器却没有存储这个SHA1校验和以及对应的脚本，会报错
* 以上报错会发生于：服务器重启；执行SCRIPT FLUSH命令或者指定的连接Redis服务器分片上并没有需要执行的键的时候

**Lua脚本的参数：**
* 调用Lua脚本至少需要三个参数：Redis连接；Lua脚本需要操作的所有键列表Keys；Lua脚本执行时的参数集合
* Redis连接必不可少
* 任意多键组成的列表Keys：Lua脚本可能会读取或者写入的所有键（有需要的时候检查是否所有传入的键都位于相同的分片里面）
* 自动的服务器分片功能的Redis集群在执行一个脚本之前，会对脚本将要访问的所有键进行检查；如果脚本将要访问的键并不在同一个服务器里面，则返回一个错误
* 最后一个参数集合，没有限制；它的作用时存储在Lua脚本内部使用的数据

### 二、Lua脚本的返回类型

当从Lua返回的不是字符串或者整数值的时候，许哟啊做一些转换